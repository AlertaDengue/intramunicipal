"0","# Normalizar e filtrar bairros"
"0","df_mun_filtrado <- df_mun %>% "
"0","  mutate(nm_bairro_norm = normalizar_bairro(nm_bairro)) %>%"
"0","  filter(!is.na(nm_bairro_norm))"
"0",""
"0","# Matching de bairros usando distância de strings"
"0","df_mun_ok <- stringdist_inner_join("
"0","  df_mun_filtrado,"
"0","  tibble(nm_bairro_ref = jv_ref$nome_bairr),"
"0","  by = c(""nm_bairro_norm"" = ""nm_bairro_ref""),"
"0","  method = ""lv"","
"0","  max_dist = 2"
"0",")"
"0",""
"0","# Classificar bairros em distritos"
"0","res_distritos <- classificar_bairros_distrito("
"0","  sp_distritos = jv_distritos_shp,"
"0","  sp_bairros = jv_shp"
"0",") %>% "
"0","  mutate(nome_bairr = normalizar_bairro(nome_bairr))"
"0",""
"0","# Sumarizar por bairro e SE"
"0","df_bairros <- df_mun_ok %>% "
"0","  count(arbo, nm_bairro_ref, sem_not, name = ""notificações"") %>%"
"0","  mutate(sem_not = as.numeric(sem_not)) %>% "
"0","  completar_dados_bairros("
"0","    bairros_unicos = unique(df_mun_ok$nm_bairro_ref),"
"0","    se_var = ""sem_not"","
"0","    nm_bairr_var = ""nm_bairro_ref"","
"0","    group_var = ""arbo"","
"0","    max_semana_epidemiologica = weeks_2_plot_full[3]"
"0","  ) %>%"
"0","  left_join(jv_pop, by = c(""nm_bairro_ref"" = ""nome_bairr"")) %>%"
"0","  left_join(jv_shp, by = c(""nm_bairro_ref"" = ""nome_bairr"")) %>% "
"0","  left_join(res_distritos, by = c(""nm_bairro_ref"" = ""nome_bairr"")) %>% "
"0","  select(nm_bairro_ref, sem_not, arbo, distrito, "
"0","         notificações, pop, geometry, geometry_distritos)"
"0",""
"0","# Agregar por distrito"
"0","df_distritos <- df_bairros %>%"
"0","  group_by(distrito, sem_not, arbo) %>%"
"0","  summarise("
"0","    pop = sum(pop, na.rm = TRUE),"
"0","    notificações = sum(notificações, na.rm = TRUE),"
"0","    geometry = st_union(geometry_distritos),"
"0","    .groups = ""drop"""
"0","  ) %>%"
"0","  mutate("
"0","    inc = notificações/pop*1e5,"
"0","    ano = substr(sem_not, 1, 4)"
"0","  ) %>%"
"0","  filter(ano %in% c(ano_atual-1, ano_atual))"
"0",""
"0","# Preparar dados para nowcasting"
"0","nowcastdg_mun <- df_mun %>% "
"0","  filter(year(dt_sin_pri) %in% c(ano_atual-2, ano_atual-1, ano_atual) & arbo == ""dengue"") %>%"
"0","  drop_na(dt_sin_pri, dt_digita) %>%"
"0","  select(arbo, dt_digita, dt_sin_pri, dt_notific)"
"0",""
"0","nowcastdg_dis <- df_mun_ok %>% "
"0","  filter(arbo == ""dengue"") %>% "
"0","  left_join(res_distritos %>% select(nome_bairr, distrito),"
"0","            by = c(""nm_bairro_ref"" = ""nome_bairr"")) %>% "
"0","  select(dt_digita, dt_sin_pri, dt_notific, distrito)"
