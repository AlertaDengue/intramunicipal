"0","# Tabela 1 - Casos perdidos"
"0","tab1_dados <- perda_notificação %>% "
"0","  filter(sem_not %in% weeks_2_plot_full) %>% "
"0","  arrange(arbo, desc(sem_not)) %>% "
"0","  ungroup()"
"0",""
"0","tab1 <- tab1_dados %>%"
"0","  select(sem_not, notificações, perca, pct_perca) %>% "
"0","  mutate(pct_perca = round(pct_perca, 2)) %>%"
"0","  kbl(col.names = c(""SE"", ""Casos notificados"", ""Casos perdidos"", ""% perdidos""),"
"0","      booktabs = TRUE,"
"0","      align = ""c"","
"0","      linesep = """") %>%"
"0","  kable_styling(latex_options = c(""HOLD_position"", ""striped""),"
"0","                font_size = 10,"
"0","                position = ""center"") %>%"
"0","  pack_rows(index = table(tab1_dados$arbo))"
"0",""
"0",""
"0","# Tabela 2 - Resumo municipal"
"0","casos_acumulado_municipio_dengon_ultimasSE <- dados_api %>% "
"0","  filter(substr(SE, 1, 4) == ano_atual & arbo == ""dengue"") %>% "
"0","  select(SE, casos) %>%"
"0","  arrange(SE) %>%"
"0","  mutate(acumulado = cumsum(casos)) %>% "
"0","  filter(SE %in% weeks_2_plot_full) %>% "
"0","  mutate(arbo = ""dengue"") %>% "
"0","  arrange(desc(SE))"
"0",""
"0","casos_acumulado_municipio_chikon_ultimasSE <- dados_api %>% "
"0","  filter(substr(SE, 1, 4) == ano_atual & arbo == ""chikon"") %>% "
"0","  select(SE, casos) %>%"
"0","  arrange(SE) %>%"
"0","  mutate(acumulado = cumsum(casos)) %>% "
"0","  filter(SE %in% weeks_2_plot_full) %>% "
"0","  mutate(arbo = ""chikungunya"") %>% "
"0","  arrange(desc(SE))"
"0",""
"0","tab2_dengon <- dados_api %>% "
"0","  filter(arbo == ""dengue"" & SE %in% weeks_2_plot_full) %>% "
"0","  left_join(jv_mun_nowscat$mun_nowcast %>% "
"0","              select(ano_epi, Median) %>% "
"0","              mutate(ano_epi = as.numeric(ano_epi)),"
"0","            by = c(""SE"" = ""ano_epi"")) %>% "
"0","  mutate("
"0","    arbo = ""dengue"","
"0","    receptivo = case_when(receptivo == 0 ~ ""baixa"", TRUE ~ ""alta""),"
"0","    nivel = case_when("
"0","      nivel == 1 ~ ""verde"", nivel == 2 ~ ""amarelo"","
"0","      nivel == 3 ~ ""laranja"", nivel == 4 ~ ""vermelho"""
"0","    ),"
"0","    p_inc100k = round(p_inc100k, 1)"
"0","  ) %>% "
"0","  select(arbo, SE, casos, Median, p_inc100k, receptivo, nivel)"
"0",""
"0","tab2_chikon <- dados_api %>% "
"0","  filter(arbo == ""chikon"" & SE %in% weeks_2_plot_full) %>% "
"0","  mutate("
"0","    arbo = ""chikungunya"","
"0","    receptivo = case_when(receptivo == 0 ~ ""baixa"", TRUE ~ ""alta""),"
"0","    nivel = case_when("
"0","      nivel == 1 ~ ""verde"", nivel == 2 ~ ""amarelo"","
"0","      nivel == 3 ~ ""laranja"", nivel == 4 ~ ""vermelho"""
"0","    ),"
"0","    Median = 0,"
"0","    p_inc100k = round(p_inc100k, 1)"
"0","  ) %>% "
"0","  select(arbo, SE, casos, Median, p_inc100k, receptivo, nivel)"
"0",""
"0","tab2 <- rbind(tab2_dengon, tab2_chikon) %>% "
"0","  mutate(acumulado = c(casos_acumulado_municipio_dengon_ultimasSE$acumulado,"
"0","                       casos_acumulado_municipio_chikon_ultimasSE$acumulado)) %>% "
"0","  select(SE, arbo, acumulado, casos, Median, p_inc100k, nivel) %>%"
"0","  mutate("
"0","    casos = round(casos, 0),"
"0","    Median = round(Median, 0),"
"0","    p_inc100k = round(p_inc100k, 0)"
"0","  )"
"0",""
"0","# Criar tabela kable"
"0","tab2_dados <- rbind(tab2_dengon, tab2_chikon) %>% "
"0","  mutate(acumulado = c(casos_acumulado_municipio_dengon_ultimasSE$acumulado,"
"0","                       casos_acumulado_municipio_chikon_ultimasSE$acumulado)) %>% "
"0","  select(SE, arbo, acumulado, casos, Median, p_inc100k, nivel) %>%"
"0","  mutate("
"0","    casos = round(casos, 0),"
"0","    Median = round(Median, 0),"
"0","    p_inc100k = round(p_inc100k, 0),"
"0","    arbo = factor(arbo,levels=c(""dengue"",""chikungunya""))"
"0","  ) %>% "
"0","  arrange(arbo, desc(SE))"
"0",""
"0","tab2 <- tab2_dados %>%"
"0","  select(SE, acumulado, casos, Median, p_inc100k, nivel) %>%"
"0","  kbl(col.names = c(""SE"", ""Casos acumulados"", ""Casos notificados"", "
"0","                    ""Casos estimados"", ""Incidencia*"", ""Nivel""),"
"0","      booktabs = TRUE,"
"0","      align = ""c"","
"0","      linesep = """","
"0","      escape = FALSE) %>%"
"0","  kable_styling(latex_options = c(""HOLD_position"", ""striped""),"
"0","                font_size = 9,"
"0","                position = ""center"") %>%"
"0","  pack_rows(index = table(tab2_dados$arbo)) %>%"
"0","  column_spec(6, color = ifelse(tab2_dados$nivel == ""verde"", ""green"","
"0","                                ifelse(tab2_dados$nivel == ""amarelo"", ""gold"","
"0","                                       ifelse(tab2_dados$nivel == ""laranja"", ""darkorange"","
"0","                                              ifelse(tab2_dados$nivel == ""vermelho"", ""red"", ""black"")))),"
"0","              bold = TRUE) %>%"
"0","  footnote(general = ""* Casos por 100 mil habitantes"", threeparttable = TRUE)"
"0",""
"0","# Tabela limiar"
"0","tab_limiar <- data.frame("
"0","  Limiar = c(""Pre-sazonal"", ""Epidemico"", ""Pos-sazonal""),"
"0","  Valor = c(limiar_preseason, limiar_epidemico, limiar_posseason)"
"0",") %>%"
"0","  kbl(col.names = c(""Limiar"", ""Incidencia (casos/100 mil hab.)""),"
"0","      booktabs = TRUE,"
"0","      align = ""c"","
"0","      linesep = """") %>%"
"0","  kable_styling(latex_options = c(""HOLD_position""),"
"0","                font_size = 10,"
"0","                position = ""center"")"
"0",""
"0","# Tabela 3 - Distritos Dengue"
"0","casos_acumulados_distrito_dengon <- df_distritos %>% "
"0","  filter(substr(sem_not, 1, 4) == ano_atual & arbo == ""dengue"") %>% "
"0","  select(sem_not, casos, distrito) %>%"
"0","  arrange(sem_not, distrito) %>%  "
"0","  group_by(distrito) %>%"
"0","  mutate(acumulado = cumsum(casos)) %>% "
"0","  filter(sem_not %in% weeks_2_plot_full) %>% "
"0","  arrange(distrito, desc(sem_not))"
"0",""
"0","tab3_dados <- df_distritos %>% "
"0","  filter(arbo == ""dengue"" & ano == ano_atual & sem_not %in% weeks_2_plot_full) %>%"
"0","  group_by(sem_not, distrito) %>% "
"0","  summarise(casos_notificados = sum(casos), nivel = sum(nivel)) %>%"
"0","  mutate("
"0","    pop = populacoes_distritos,"
"0","    inc = casos_notificados/pop * 1e5,"
"0","    nivel = case_when("
"0","      nivel == 1 ~ ""verde"", nivel == 2 ~ ""amarelo"","
"0","      nivel == 3 ~ ""laranja"", nivel == 4 ~ ""vermelho"""
"0","    ),"
"0","    sem_not = as.numeric(as.character(sem_not)),"
"0","    distrito = factor(distrito)"
"0","  ) %>% "
"0","  left_join(casos_acumulados_distrito_dengon %>% "
"0","              select(sem_not, distrito, acumulado)) %>% "
"0","  ungroup() %>%"
"0","  arrange(distrito, desc(sem_not)) %>%"
"0","  select(sem_not, acumulado, casos_notificados, inc, nivel, distrito)"
"0",""
"0","tab3 <- tab3_dados %>%"
"0","  mutate(inc = round(inc, 1)) %>%"
"0","  select(sem_not, acumulado, casos_notificados, inc, nivel) %>%"
"0","  kbl(col.names = c(""SE"", ""Casos acumulados"", ""Casos notificados"", "
"0","                    ""Incidencia*"", ""Nivel""),"
"0","      booktabs = TRUE,"
"0","      align = ""c"","
"0","      linesep = """","
"0","      escape = FALSE) %>%"
"0","  kable_styling(latex_options = c(""HOLD_position"", ""striped""),"
"0","                font_size = 10,"
"0","                position = ""center"") %>%"
"0","  pack_rows(index = table(tab3_dados$distrito)) %>%"
"0","  column_spec(5, color = ifelse(tab3_dados$nivel == ""verde"", ""green"","
"0","                                ifelse(tab3_dados$nivel == ""amarelo"", ""gold"","
"0","                                       ifelse(tab3_dados$nivel == ""laranja"", ""darkorange"","
"0","                                              ifelse(tab3_dados$nivel == ""vermelho"", ""red"", ""black"")))),"
"0","              bold = TRUE) %>%"
"0","  footnote(general = ""* Casos por 100 mil habitantes"", threeparttable = TRUE)"
"0",""
"0",""
"0","# Tabela 4 - Distritos Chikungunya"
"0","casos_acumulados_distrito_chikon <- df_distritos %>% "
"0","  filter(substr(sem_not, 1, 4) == ano_atual & arbo == ""chikon"") %>% "
"0","  select(sem_not, casos, distrito) %>%"
"0","  arrange(sem_not, distrito) %>%  "
"0","  group_by(distrito) %>%"
"0","  mutate(acumulado = cumsum(casos)) %>% "
"0","  filter(sem_not %in% weeks_2_plot_full) %>% "
"0","  arrange(distrito, desc(sem_not))"
"0",""
"0",""
"0","tab4_dados <- df_distritos %>%"
"0","  filter(arbo == ""chikon"" & ano == ano_atual & sem_not %in% weeks_2_plot_full) %>%"
"0","  group_by(sem_not, distrito) %>% "
"0","  summarise(casos_notificados = sum(casos), nivel = sum(nivel)) %>%"
"0","  mutate("
"0","    pop = populacoes_distritos,"
"0","    inc = casos_notificados/pop * 1e5,"
"0","    nivel = case_when("
"0","      nivel == 1 ~ ""verde"", nivel == 2 ~ ""amarelo"","
"0","      nivel == 3 ~ ""laranja"", nivel == 4 ~ ""vermelho"""
"0","    ),"
"0","    sem_not = as.numeric(as.character(sem_not)),"
"0","    distrito = factor(distrito)"
"0","  ) %>% "
"0","  left_join(casos_acumulados_distrito_chikon %>% "
"0","              select(sem_not, distrito, acumulado)) %>% "
"0","  ungroup() %>%"
"0","  arrange(distrito, desc(sem_not)) %>%"
"0","  select(sem_not, acumulado, casos_notificados, inc, nivel, distrito)"
"0",""
"0","tab4 <- tab4_dados %>%"
"0","  mutate(inc = round(inc, 1)) %>%"
"0","  select(sem_not, acumulado, casos_notificados, inc, nivel) %>%"
"0","  kbl(col.names = c(""SE"", ""Casos acumulados"", ""Casos notificados"", "
"0","                    ""Incidencia*"", ""Nivel""),"
"0","      booktabs = TRUE,"
"0","      align = ""c"","
"0","      linesep = """","
"0","      escape = FALSE) %>%"
"0","  kable_styling(latex_options = c(""HOLD_position"", ""striped""),"
"0","                font_size = 10,"
"0","                position = ""center"") %>%"
"0","  pack_rows(index = table(tab4_dados$distrito)) %>%"
"0","  column_spec(5, color = ifelse(tab4_dados$nivel == ""verde"", ""green"","
"0","                          ifelse(tab4_dados$nivel == ""amarelo"", ""gold"","
"0","                          ifelse(tab4_dados$nivel == ""laranja"", ""darkorange"","
"0","                          ifelse(tab4_dados$nivel == ""vermelho"", ""red"", ""black"")))),"
"0","              bold = TRUE) %>%"
"0","  footnote(general = ""* Casos por 100 mil habitantes"", threeparttable = TRUE)"
"0",""
"0","if(F){"
"0","# Tabela 5 - Top 10 Bairros Dengue"
"0","tab5 <- bairros_ultima_semana_dengue %>% "
"0","  mutate("
"0","    inc = round(inc, 1),"
"0","    Rt = round(Rt, 1),"
"0","    nivel = case_when("
"0","      nivel == 1 ~ ""verde"", nivel == 2 ~ ""amarelo"","
"0","      nivel == 3 ~ ""laranja"", nivel == 4 ~ ""vermelho"""
"0","    )"
"0","  ) %>% "
"0","  arrange(desc(inc)) %>%"
"0","  ungroup() %>% "
"0","  gt(groupname_col = ""distrito"") %>%"
"0","  cols_label("
"0","    nm_bairro_ref = ""Bairro"","
"0","    casos = ""Casos notificados"","
"0","    distrito = ""Distrito"","
"0","    inc = ""Incidencia"","
"0","    nivel = ""Nivel"","
"0","    semanas_com_nivel3_4 = ""Semanas com nivel critico"""
"0","  ) %>%"
"0","  tab_options(table.font.size = ""14px"") %>% "
"0","  tab_style("
"0","    style = cell_text(align = ""center"", v_align = ""middle""),  "
"0","    locations = list(cells_body(), cells_column_labels())"
"0","  ) %>% "
"0","  tab_style(style = cell_text(color = ""green"", weight = ""bold""),"
"0","            locations = cells_body(columns = nivel, rows = nivel == ""verde"")) %>%"
"0","  tab_style(style = cell_text(color = ""gold"", weight = ""bold""),"
"0","            locations = cells_body(columns = nivel, rows = nivel == ""amarelo"")) %>%"
"0","  tab_style(style = cell_text(color = ""darkorange"", weight = ""bold""),"
"0","            locations = cells_body(columns = nivel, rows = nivel == ""laranja"")) %>%"
"0","  tab_style(style = cell_text(color = ""red"", weight = ""bold""),"
"0","            locations = cells_body(columns = nivel, rows = nivel == ""vermelho"")) %>% "
"0","  tab_header(title = md(""dengue"")) %>% "
"0","  tab_footnote("
"0","    footnote = ""Janela de 5 semanas"","
"0","    locations = cells_column_labels(columns = semanas_com_nivel3_4)"
"0","  )"
"0",""
"0","# Tabela 6 - Top 10 Bairros Chikungunya"
"0","tab6 <- bairros_ultima_semana_chikon %>%"
"0","  mutate("
"0","    inc = round(inc, 1),"
"0","    Rt = round(Rt, 1),"
"0","    nivel = case_when("
"0","      nivel == 1 ~ ""verde"", nivel == 2 ~ ""amarelo"","
"0","      nivel == 3 ~ ""laranja"", nivel == 4 ~ ""vermelho"""
"0","    )"
"0","  ) %>% "
"0","  arrange(desc(inc)) %>%"
"0","  ungroup() %>%"
"0","  gt(groupname_col = ""distrito"") %>%"
"0","  cols_label("
"0","    nm_bairro_ref = ""Bairro"","
"0","    casos = ""Casos notificados"","
"0","    distrito = ""Distrito"","
"0","    inc = ""Incidencia"","
"0","    nivel = ""Nivel"","
"0","    semanas_com_nivel3_4 = ""Semanas com nivel critico"""
"0","  ) %>%"
"0","  tab_options(table.font.size = ""14px"") %>%"
"0","  tab_style("
"0","    style = cell_text(align = ""center"", v_align = ""middle""),"
"0","    locations = list(cells_body(), cells_column_labels())"
"0","  ) %>%"
"0","  tab_style(style = cell_text(color = ""green"", weight = ""bold""),"
"0","            locations = cells_body(columns = nivel, rows = nivel == ""verde"")) %>%"
"0","  tab_style(style = cell_text(color = ""gold"", weight = ""bold""),"
"0","            locations = cells_body(columns = nivel, rows = nivel == ""amarelo"")) %>%"
"0","  tab_style(style = cell_text(color = ""darkorange"", weight = ""bold""),"
"0","            locations = cells_body(columns = nivel, rows = nivel == ""laranja"")) %>%"
"0","  tab_style(style = cell_text(color = ""red"", weight = ""bold""),"
"0","            locations = cells_body(columns = nivel, rows = nivel == ""vermelho"")) %>%"
"0","  tab_header(title = md(""chikungunya"")) %>% "
"0","  tab_footnote("
"0","    footnote = ""Janela de 5 semanas"","
"0","    locations = cells_column_labels(columns = semanas_com_nivel3_4)"
"0","  )"
"0","}"
"0",""
"0","# Tabela indicadores"
"0","dados_indicadores <- tibble::tribble("
"0","  ~Indicadores, ~Descricao,"
"0","  ""Casos"", ""Número de casos notificados, por data de primeiro sintoma. Esse dado está sujeito a atualização"","
"0","  ""Casos esperados"", ""Estimação do número de casos atuais após correção estatística do atraso de notificação"","
"0","  ""Receptividade"", ""Condições ambientais favoráveis para reprodução e competência do mosquito para transmissão de dengue baseado no clima e na presença de vírus"","
"0","  ""Transmissão"", ""Indicação de transmissão sustentada de dengue, isso é, sequência de semanas com Rt > 1 atualmente ou recentemente"","
"0","  ""Incidência"", ""Indica o quão alta é a incidência semanal atual em comparação com os valores históricos"","
"0","  ""Nível"", ""Nível de atenção para a situação da dengue calculado pelo Infodengue. Veja o Quadro de comparação do nível do Infodengue com os níveis do Plano de Contingência Nacional da Dengue do Ministério da Saúde."""
"0",")"
"0",""
"0","tabela_indicadores <- dados_indicadores %>%"
"0","  kbl(booktabs = TRUE,"
"0","      align = c(""l"", ""l""),"
"0","      linesep = """","
"0","      col.names = NULL) %>%"
"0","  kable_styling(latex_options = c(""HOLD_position""),"
"0","                font_size = 10,"
"0","                position = ""center"") %>%"
"0","  column_spec(1, width = ""4cm"", bold = TRUE) %>%"
"0","  column_spec(2, width = ""10cm"")"
"0",""
"0",""
"0","# Tabela anexo"
"0","dados_anexo <- tibble::tribble("
"0","  ~cor, ~nivel_atencao, ~situacao, ~nivel_contingencia, ~situacao_detalhada,"
"0","  ""verde"", ""Condições não favoráveis para transmissão / baixo risco"", "
"0","  ""Atividade viral baixa / temperatura ou umidade relativa baixa/ Poucos rumores no Twitter"", "
"0","  ""Nenhuma ação de contingência necessária"", ""-"","
"0","  ""amarelo"", ""Atenção: Condições favoráveis com presença de circulação viral"", "
"0","  ""Atividade viral presente (pelo menos 1 caso) / Temperatura ou umidade relativa favoráveis ao vetor/ Presença de rumores no Twitter"", "
"0","  ""Pré-contingência"", ""Condição climática favorece atividade do vetor"","
"0","  ""laranja"", ""Transmissão sustentada"", "
"0","  ""Incidência crescente porém dentro dos níveis históricos"", "
"0","  ""Nível 0"", ""Incidência em ascensão por três semanas seguidas + introdução/reintrodução de novo sorotipo ou IP ultrapassar o limite de 1% ou aumento de rumores no Twitter na última semana."","
"0","  ""laranja"", ""Transmissão sustentada"", "
"0","  ""Incidência crescente porém dentro dos níveis históricos"", "
"0","  ""Nível 1"", ""Incidência permanecer em ascensão por quatro semanas consecutivas e/ou ocorra notificação de caso grave suspeito ou suspeita de óbito por dengue."","
"0","  ""vermelho"", ""Incidência alta"", "
"0","  ""Incidência alta para os padrões históricos (acima de 90%)"", "
"0","  ""Nível 2"", ""Número de casos notificados para o ano ultrapassar os do limite máximo com transmissão sustentada de acordo com o diagrama de controle e/ou ocorra um aglomerado de óbitos suspeitos por dengue."","
"0","  ""vermelho"", ""Incidência alta"", "
"0","  ""Incidência alta para os padrões históricos (acima de 90%)"", "
"0","  ""Nível 3"", ""Número de casos notificados para o ano ultrapassar os do limite máximo com transmissão sustentada de acordo com o diagrama de controle e de mortalidade por dengue nas últimas quatro semanas for maior ou igual a 0,06/100 mil habitantes."""
"0",")"
"0",""
"0","tabela_anexo <- dados_anexo %>%"
"0","  kbl(booktabs = TRUE,"
"0","      col.names = c(""Cor"", ""Nível de Atenção"", ""Situação"", ""Nível de contingência"", ""Situação""),"
"0","      align = c(""c"", ""l"", ""l"", ""l"", ""l""),"
"0","      linesep = """","
"0","      escape = FALSE,"
"0","      caption = ""Plano de Contingência Nacional para Controle da Dengue"") %>%"
"0","  kable_styling(latex_options = c(""HOLD_position"", ""scale_down""),"
"0","                font_size = 9,"
"0","                position = ""center"") %>%"
"0","  column_spec(1, width = ""1.5cm"", bold = TRUE,"
"0","              background = c(""green"", ""yellow"", ""orange"", ""orange"", ""red"", ""red"")) %>%"
"0","  column_spec(2, width = ""3.5cm"") %>%"
"0","  column_spec(3, width = ""4cm"") %>%"
"0","  column_spec(4, width = ""2.5cm"") %>%"
"0","  column_spec(5, width = ""4cm"")"
"0",""
"0",""
