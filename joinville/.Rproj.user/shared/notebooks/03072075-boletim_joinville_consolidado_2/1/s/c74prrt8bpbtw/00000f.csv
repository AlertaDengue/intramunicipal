"0","# FIGURA 1 - Mapbiomas (uso do solo)"
"0","if (file.exists(""./mapbiomas-brazil-collection-90-2023.tif"")) {"
"0","  mapbiomas <- terra::rast(""./mapbiomas-brazil-collection-90-2023.tif"")"
"0","  mapbiomas2 <- as.data.frame(mapbiomas, xy = TRUE)"
"0","  "
"0","  mapbiomas2 <- mapbiomas2 %>% "
"0","    filter(classification_2023 != 0) %>%"
"0","    mutate(class = case_when("
"0","      classification_2023 == 3 ~ ""Formacao Florestal"","
"0","      classification_2023 == 9 ~ ""Agropecuaria"","
"0","      classification_2023 == 21 ~ ""Agropecuaria"","
"0","      classification_2023 == 15 ~ ""Agropecuaria"","
"0","      classification_2023 == 41 ~ ""Agropecuaria"","
"0","      classification_2023 == 29 ~ ""Afloramento Rochoso"","
"0","      classification_2023 == 39 ~ ""Agropecuaria"","
"0","      classification_2023 == 33 ~ ""Rio, Lago e Oceano"","
"0","      classification_2023 == 49 ~ ""Restinga Arborea"","
"0","      classification_2023 == 5 ~ ""Mangue"","
"0","      classification_2023 == 40 ~ ""Agropecuaria"","
"0","      classification_2023 == 25 ~ ""Outras Areas nao Vegetadas"","
"0","      classification_2023 == 24 ~ ""Area Urbanizada"","
"0","      classification_2023 == 30 ~ ""Mineracao"","
"0","      classification_2023 == 31 ~ ""Aquicultura"""
"0","    ))"
"0","  "
"0","  mapbiomas_colors <- c("
"0","    ""Formacao Florestal"" = ""#1f8d49"","
"0","    ""Mangue"" = ""#04381d"","
"0","    ""Agropecuaria"" = ""#ffefc3"","
"0","    ""Area Urbanizada"" = ""#d4271e"","
"0","    ""Outras Areas nao Vegetadas"" = ""#db4d4f"","
"0","    ""Afloramento Rochoso"" = ""#ffaa5f"","
"0","    ""Mineracao"" = ""#9c0027"","
"0","    ""Aquicultura"" = ""#091077"","
"0","    ""Rio, Lago e Oceano"" = ""#2532e4"","
"0","    ""Restinga Arborea"" = ""#02d659"""
"0","  )"
"0","  "
"0","  jv_urbano <- jv_shp %>% sf::st_union()"
"0","  jv_bairros_rural <- jv_shp %>% "
"0","    filter(nome_bairr %in% c(""MORRO DO MEIO"", ""RIO BONITO"","
"0","                             ""PIRABEIRABA"", ""VILA CUBATAO"", ""VILA NOVA"")) %>%"
"0","    select(geometry, nome_bairr)"
"0","  "
"0","  fig1 <- mapbiomas2 %>% "
"0","    filter(classification_2023 != 0) %>%"
"0","    ggplot() +"
"0","    geom_tile(aes(x = x, y = y, fill = class)) +"
"0","    geom_sf(data = jv_urbano, alpha = 0, linewidth = 0.8, "
"0","            color = ""black"", linetype = ""solid"") +"
"0","    geom_sf(data = jv_bairros_rural, alpha = 0.6, fill = ""black"") +"
"0","    scale_fill_manual("
"0","      values = mapbiomas_colors,"
"0","      name = ""Uso do solo"","
"0","      na.value = ""white"","
"0","      guide = guide_legend(nrow = 3, byrow = TRUE)"
"0","    ) +"
"0","    theme_pubclean() +"
"0","    theme(legend.position = ""top"","
"0","          axis.ticks = element_blank(),"
"0","          axis.text = element_blank()) +"
"0","    labs(x = """", y = """") +"
"0","    annotate(geom = ""text"", x = Inf, y = Inf,  "
"0","             label = ""Linha preta: Limite urbano"","
"0","             hjust = 1.1, vjust = 1, size = 3.5, color = ""black"")"
"0","} else {"
"0","  fig1 <- NULL"
"0","}"
"0",""
"0","# FIGURA 2 - Mapa de distritos"
"0","fig2 <- ggplot() +"
"0","  geom_sf(data = jv_mun_shape, "
"0","          aes(geometry = geom, fill = ""Regiao Rural""),"
"0","          color = ""black"") +"
"0","  geom_sf("
"0","    data = df_bairros %>% st_as_sf() %>%"
"0","      filter(sem_not == weeks_2_plot_full[3] & arbo == ""dengue""),"
"0","    aes(geometry = geometry, fill = distrito),"
"0","    color = ""black"", linewidth = 0.3"
"0","  ) + "
"0","  ggpubr::theme_pubclean(base_size = 12) +"
"0","  theme(axis.text = element_blank(), axis.ticks = element_blank()) + "
"0","  scale_fill_manual("
"0","    name = """","
"0","    values = c(""Regiao Rural"" = ""white"","
"0","               ""Distrito Centro"" = ""grey20"","
"0","               ""Distrito Norte"" = ""grey50"", "
"0","               ""Distrito Sul"" = ""grey70"")"
"0","  )"
"0",""
"0","# FIGURA 3 - Completude dos dados"
"0",""
"0","df_mun_id_bairro_miss <- df_mun %>% "
"0","  group_by(sem_not,arbo) %>% "
"0","  summarise("
"0","    total_id = n(),"
"0","    n_missing = sum(id_bairro == 0 | is.na(id_bairro), na.rm = TRUE),"
"0","    perc_na_id = 100*(n_missing/total_id)"
"0","  ) "
"0",""
"0","df_mun_nm_bairro_miss <- df_mun %>% "
"0","  group_by(sem_not,arbo) %>% "
"0","  summarise("
"0","    total_nm = n(),"
"0","    n_na_nm = sum(is.na(nm_bairro)),  "
"0","    perc_na_nome = 100*(n_na_nm/total_nm)"
"0","  ) "
"0",""
"0","df_mun_miss <- left_join(df_mun_id_bairro_miss,"
"0","      df_mun_nm_bairro_miss) %>% as.data.frame() "
"0",""
"0",""
"0","fig3A <- df_mun_miss %>% "
"0","  filter(sem_not >= paste0(ano_atual, ""01"") & arbo == ""dengue"") %>% "
"0","  select(sem_not, arbo, perc_na_id, perc_na_nome) %>% "
"0","  pivot_longer(cols = c(perc_na_id, perc_na_nome), "
"0","               names_to = ""var"", values_to = ""n"") %>%"
"0","  mutate("
"0","    var = case_when("
"0","      var == ""perc_na_id"" ~ ""ID_BAIRRO"","
"0","      var == ""perc_na_nome"" ~ ""NM_BAIRRO"""
"0","    ),"
"0","    arbo = ifelse(arbo == ""chikon"", ""chikungunya"", arbo),"
"0","    arbo = factor(arbo, levels = c(""dengue"", ""chikungunya"")),"
"0","    ew = substr(sem_not, 5, 6),"
"0","    ano = substr(sem_not, 1, 4)"
"0","  ) %>%"
"0","  complete("
"0","    ew = sprintf(""%02d"", 1:52),"
"0","    ano = as.character(ano_atual),"
"0","    arbo = c(""dengue"", ""chikungunya""),"
"0","    var = c(""ID_BAIRRO"", ""NM_BAIRRO""),"
"0","    fill = list(n = NA)"
"0","  ) %>% "
"0","  filter(ano == ano_atual) %>% "
"0","  ggplot() +"
"0","  geom_hline(yintercept = 70, linetype = ""dashed"", color = ""black"") +"
"0","  geom_point(aes(x = factor(ew), y = 100-n, col = var, group = var), alpha = 1) +"
"0","  geom_text(aes(label = ""Quantidade minima"", x = 10, y = 65)) +"
"0","  theme_minimal(base_size = 11) +"
"0","  labs(y = ""% de completude"", x = ""Semanas Epidemiologicas"", "
"0","       col = """", subtitle = ""dengue"") +"
"0","  scale_color_manual(values = c(""blue3"", ""red3"")) +"
"0","  scale_x_discrete(breaks = c(""01"", ""10"", ""20"", ""30"", ""40"", ""50"")) +"
"0","  theme(axis.text.x = element_text(angle = 60, hjust = 1),"
"0","        axis.text = element_text(colour = ""black""),"
"0","        legend.position = ""top"") +"
"0","  ylim(0, 100)"
"0",""
"0","fig3B <- df_mun_miss %>% "
"0","  filter(sem_not >= paste0(ano_atual, ""01"") & arbo == ""chikon"") %>% "
"0","  select(sem_not, arbo, perc_na_id, perc_na_nome) %>% "
"0","  pivot_longer(cols = c(perc_na_id, perc_na_nome), "
"0","               names_to = ""var"", values_to = ""n"") %>%"
"0","  mutate("
"0","    var = case_when("
"0","      var == ""perc_na_id"" ~ ""ID_BAIRRO"","
"0","      var == ""perc_na_nome"" ~ ""NM_BAIRRO"""
"0","    ),"
"0","    arbo = ifelse(arbo == ""chikon"", ""chikungunya"", arbo),"
"0","    arbo = factor(arbo, levels = c(""dengue"", ""chikungunya"")),"
"0","    ew = substr(sem_not, 5, 6),"
"0","    ano = substr(sem_not, 1, 4)"
"0","  ) %>%"
"0","  complete("
"0","    ew = sprintf(""%02d"", 1:52),"
"0","    ano = as.character(ano_atual),"
"0","    arbo = c(""dengue"", ""chikungunya""),"
"0","    var = c(""ID_BAIRRO"", ""NM_BAIRRO""),"
"0","    fill = list(n = NA)"
"0","  ) %>% "
"0","  filter(ano == ano_atual) %>% "
"0","  ggplot() +"
"0","  geom_hline(yintercept = 70, linetype = ""dashed"", color = ""black"") +"
"0","  geom_point(aes(x = factor(ew), y = 100-n, col = var, group = var), alpha = 1) +"
"0","  geom_text(aes(label = ""Quantidade minima"", x = 10, y = 65)) +"
"0","  theme_minimal(base_size = 11) +"
"0","  labs(y = ""% de completude"", x = ""Semanas Epidemiologicas"", "
"0","       col = """", subtitle = ""chikungunya"") +"
"0","  scale_x_discrete(breaks = c(""01"", ""10"", ""20"", ""30"", ""40"", ""50"")) +"
"0","  scale_color_manual(values = c(""blue3"", ""red3"")) +"
"0","  theme(axis.text.x = element_text(angle = 60, hjust = 1),"
"0","        axis.text = element_text(colour = ""black""),"
"0","        legend.position = ""top"") +"
"0","  ylim(0, 100)"
"0",""
"0","fig3 <- ggarrange(fig3A, fig3B, ncol = 1, labels = letters[1:2])"
"0",""
"0","# FIGURA 4 - Perda de notificação"
"0",""
"0","perda_notificação <- df_bairros %>% "
"0","  select(sem_not,casos,arbo) %>% "
"0","  group_by(sem_not,arbo) %>% "
"0","  summarise(notificações = sum(casos)) %>% "
"0","   left_join("
"0","    df_mun %>% "
"0","      select(sem_not,nu_notific,arbo) %>% "
"0","      mutate(sem_not = as.numeric(sem_not)) %>% "
"0","      group_by(sem_not,arbo) %>% "
"0","      summarise(notificações_bruto = n_distinct(nu_notific))"
"0","  ) %>% "
"0","  mutate(notificações_bruto = ifelse(is.na(notificações_bruto),0,notificações_bruto),"
"0","         perca = abs(notificações_bruto - notificações),"
"0","         pct_perca = case_when("
"0","           is.na(perca/notificações_bruto) ~ 0,"
"0","           TRUE ~ (perca/notificações_bruto)*100"
"0","         )) %>% "
"0","  mutate(arbo = factor(arbo,levels = c(""dengue"",""chikon""),"
"0","                       labels = c(""dengue"",""chikungunya"")))"
"0",""
"0","fig4A <- perda_notificação %>% "
"0","  filter(sem_not >= paste0(ano_atual-1, substr(weeks_2_plot_full[3], 5, 6)) &"
"0","           arbo == ""dengue"") %>% "
"0","  ggplot() + "
"0","  geom_line(aes(x = factor(sem_not), y = perca, group = 1, col = ""Perdidos"")) + "
"0","  geom_line(aes(x = factor(sem_not), y = notificações, group = 1, col = ""notificacoes"")) +"
"0","  labs(x = ""Semanas Epidemiologicas"", y = ""Casos"", colour = """","
"0","       subtitle = ""dengue"") +"
"0","  scale_color_manual(values = c(""black"", ""red"")) +"
"0","  scale_x_discrete(breaks = levels(factor(df_mun$sem_not))["
"0","    seq(1, length(levels(factor(df_mun$sem_not))), by = 8)]) + "
"0","  theme_minimal(base_size = 11) +"
"0","  theme(axis.text.x = element_text(angle = 60, hjust = 1),"
"0","        legend.position = ""top"")"
"0",""
"0","fig4B <- perda_notificação %>% "
"0","  filter(sem_not >= paste0(ano_atual-1, substr(weeks_2_plot_full[3], 5, 6)) &"
"0","           arbo == ""chikungunya"") %>% "
"0","  ggplot() + "
"0","  geom_line(aes(x = factor(sem_not), y = perca, group = 1, col = ""Perdidos"")) + "
"0","  geom_line(aes(x = factor(sem_not), y = notificações, group = 1, col = ""notificacoes"")) +"
"0","  labs(x = ""Semanas Epidemiologicas"", y = ""Casos"", colour = """","
"0","       subtitle = ""chikungunya"") +"
"0","  scale_color_manual(values = c(""black"", ""red"")) +"
"0","  scale_x_discrete(breaks = levels(factor(df_mun$sem_not))["
"0","    seq(1, length(levels(factor(df_mun$sem_not))), by = 8)]) + "
"0","  theme_minimal(base_size = 11) +"
"0","  theme(axis.text.x = element_text(angle = 60, hjust = 1),"
"0","        legend.position = ""top"")"
"0",""
"0","fig4 <- ggarrange(fig4A, fig4B, ncol = 1, labels = letters[1:2])"
