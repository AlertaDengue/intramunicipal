"0","# Adicionar temperatura e preparar dados de distritos"
"0","df_distritos <- df_distritos %>% "
"0","  rename(casos = notificações) %>% "
"0","  left_join(dados_api %>% "
"0","              ungroup() %>% "
"0","              select(SE, tempmin, arbo) %>% "
"0","              rename(temp_min = tempmin),"
"0","            by = c(""sem_not"" = ""SE"", ""arbo"")) %>% "
"0","  mutate("
"0","    id_distrito = case_when("
"0","      distrito == ""Distrito Norte"" ~ 1,"
"0","      distrito == ""Distrito Sul"" ~ 2,"
"0","      distrito == ""Distrito Centro"" ~ 3"
"0","    ),"
"0","    ano = as.numeric(substr(sem_not, 1, 4)),"
"0","    inc = casos/pop*1e5"
"0","  ) %>%"
"0","  as.data.frame()"
"0",""
"0","# Calcular alertas para distritos"
"0","ids_distrito <- unique(df_distritos$id_distrito)"
"0","nomes_distrito <- unique(df_distritos$distrito)"
"0",""
"0","df_distritos_dengon <- map2_dfr("
"0","  ids_distrito, nomes_distrito, calcular_alerta,"
"0","  data = df_distritos %>% filter(arbo == ""dengue"") %>% distinct(),"
"0","  coluna_id = ""id_distrito"","
"0","  gtdist = ""normal"","
"0","  meangt = 3,"
"0","  sdgt = 1"
"0",")"
"0",""
"0","if (any(df_distritos$arbo == ""chikon"", na.rm = TRUE)) {"
"0","  df_distritos_chikon <- map2_dfr("
"0","    ids_distrito, nomes_distrito, calcular_alerta,"
"0","    data = df_distritos %>% filter(arbo == ""chikon"") %>% distinct(),"
"0","    coluna_id = ""id_distrito"","
"0","    gtdist = ""normal"","
"0","    meangt = 2,"
"0","    sdgt = 2"
"0","  )"
"0","  df_distritos <- rbind(df_distritos_dengon, df_distritos_chikon)"
"0","} else {"
"0","  df_distritos <- df_distritos_dengon"
"0","}"
"0",""
"0","# Calcular alertas para bairros"
"0","df_bairros <- df_bairros %>% "
"0","  rename(casos = notificações) %>% "
"0","  left_join(dados_api %>% "
"0","              ungroup() %>% "
"0","              select(SE, tempmin, arbo) %>% "
"0","              rename(temp_min = tempmin),"
"0","            by = c(""sem_not"" = ""SE"", ""arbo"")) %>% "
"0","  mutate("
"0","    id_bairro = as.numeric(factor(nm_bairro_ref)),"
"0","    ano = as.numeric(substr(sem_not, 1, 4)),"
"0","    inc = casos/pop*1e5"
"0","  ) %>%"
"0","  as.data.frame()"
"0",""
"0","ids_bairro <- unique(df_bairros$id_bairro)"
"0","nomes_bairro <- unique(df_bairros$nm_bairro_ref)"
"0",""
"0","df_bairros_dengon <- map2_dfr("
"0","  ids_bairro, nomes_bairro, calcular_alerta,"
"0","  data = df_bairros %>% filter(arbo == ""dengue"") %>% distinct(),"
"0","  coluna_id = ""id_bairro"","
"0","  gtdist = ""normal"","
"0","  meangt = 3,"
"0","  sdgt = 1"
"0",")"
"0",""
"0","if (any(df_bairros$arbo == ""chikon"", na.rm = TRUE)) {"
"0","  df_bairros_chikon <- map2_dfr("
"0","    ids_bairro, nomes_bairro, calcular_alerta,"
"0","    data = df_bairros %>% filter(arbo == ""chikon"") %>% distinct(),"
"0","    coluna_id = ""id_bairro"","
"0","    gtdist = ""normal"","
"0","    meangt = 3,"
"0","    sdgt = 1"
"0","  )"
"0","  df_bairros <- rbind(df_bairros_dengon, df_bairros_chikon)"
"0","} else {"
"0","  df_bairros <- df_bairros_dengon"
"0","}"
